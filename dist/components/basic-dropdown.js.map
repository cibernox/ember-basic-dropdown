{"version":3,"file":"basic-dropdown.js","sources":["../../src/components/basic-dropdown.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport calculatePosition from '../utils/calculate-position.ts';\nimport type {\n  CalculatePosition,\n  CalculatePositionResult,\n  HorizontalPosition,\n  VerticalPosition,\n} from '../utils/calculate-position.ts';\nimport { getOwner } from '@ember/application';\nimport type Owner from '@ember/owner';\nimport { schedule } from '@ember/runloop';\nimport type { ComponentLike } from '@glint/template';\nimport type { BasicDropdownTriggerSignature } from './basic-dropdown-trigger.ts';\nimport type { BasicDropdownContentSignature } from './basic-dropdown-content.ts';\nimport { ensureSafeComponent } from '@embroider/util';\nimport { hash } from '@ember/helper';\nimport BasicDropdownTrigger from './basic-dropdown-trigger.gts';\nimport BasicDropdownContent from './basic-dropdown-content.gts';\nimport { or } from 'ember-truth-helpers';\nimport type {\n  Dropdown,\n  DropdownActions,\n  RepositionChanges,\n  TRootEventType,\n} from '../types.ts';\nimport { deprecate } from '@ember/debug';\n\n// To avoid breaking the current types export we need this\nexport type { Dropdown, DropdownActions, TRootEventType };\n\nconst UNINITIALIZED = {};\nconst IGNORED_STYLES = ['top', 'left', 'right', 'width', 'height'];\n\nexport interface BasicDropdownDefaultBlock {\n  uniqueId: string;\n  disabled: boolean;\n  isOpen: boolean;\n  actions: DropdownActions;\n  Trigger: ComponentLike<BasicDropdownTriggerSignature>;\n  Content: ComponentLike<BasicDropdownContentSignature>;\n}\n\nexport interface BasicDropdownSignature {\n  Element: HTMLElement;\n  Args: BasicDropdownArgs;\n  Blocks: {\n    default: [BasicDropdownDefaultBlock];\n  };\n}\n\nexport interface BasicDropdownArgs {\n  initiallyOpened?: boolean;\n  renderInPlace?: boolean;\n  verticalPosition?: VerticalPosition;\n  horizontalPosition?: HorizontalPosition;\n  destination?: string;\n  destinationElement?: HTMLElement;\n  disabled?: boolean;\n  dropdownId?: string;\n  rootEventType?: TRootEventType;\n  preventScroll?: boolean;\n  matchTriggerWidth?: boolean;\n  onInit?: (dropdown: Dropdown) => void;\n  registerAPI?: (dropdown: Dropdown | null) => void;\n  onOpen?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  onClose?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  triggerComponent?:\n    | string\n    | ComponentLike<BasicDropdownTriggerSignature>\n    | undefined;\n  contentComponent?:\n    | string\n    | ComponentLike<BasicDropdownContentSignature>\n    | undefined;\n  calculatePosition?: CalculatePosition;\n}\n\nexport default class BasicDropdown extends Component<BasicDropdownSignature> {\n  @tracked hPosition: HorizontalPosition | null = null;\n  @tracked vPosition: VerticalPosition | null = null;\n  @tracked top: string | undefined;\n  @tracked left: string | undefined;\n  @tracked right: string | undefined;\n  @tracked width: string | undefined;\n  @tracked height: string | undefined;\n  @tracked otherStyles: Record<string, string | number | undefined> = {};\n  @tracked isOpen = this.args.initiallyOpened || false;\n  @tracked renderInPlace =\n    this.args.renderInPlace !== undefined ? this.args.renderInPlace : false;\n  private previousVerticalPosition?: VerticalPosition | undefined;\n  private previousHorizontalPosition?: HorizontalPosition | undefined;\n  private triggerElement: HTMLElement | null = null;\n  private dropdownElement: HTMLElement | null = null;\n\n  private _uid = guidFor(this);\n  private _dropdownId: string =\n    this.args.dropdownId || `ember-basic-dropdown-content-${this._uid}`;\n  private _previousDisabled = UNINITIALIZED;\n  private _actions: DropdownActions = {\n    open: this.open.bind(this),\n    close: this.close.bind(this),\n    toggle: this.toggle.bind(this),\n    reposition: this.reposition.bind(this),\n    registerTriggerElement: this.registerTriggerElement.bind(this),\n    registerDropdownElement: this.registerDropdownElement.bind(this),\n    getTriggerElement: () => this.triggerElement,\n  };\n\n  private get horizontalPosition() {\n    return this.args.horizontalPosition || 'auto'; // auto-right | right | center | left\n  }\n\n  private get verticalPosition() {\n    return this.args.verticalPosition || 'auto'; // above | below\n  }\n\n  get destination(): string {\n    return this.args.destination || this._getDestinationId();\n  }\n\n  get destinationElement(): HTMLElement | null {\n    if (this.args.destinationElement) {\n      return this.args.destinationElement;\n    }\n\n    const element = document.getElementById(this.destination);\n\n    if (element) {\n      return element;\n    }\n\n    if (\n      this.triggerElement &&\n      this.triggerElement.getRootNode() instanceof ShadowRoot\n    ) {\n      return (this.triggerElement.getRootNode() as HTMLElement)?.querySelector(\n        `#${this.destination}`,\n      );\n    }\n\n    return null;\n  }\n\n  get disabled(): boolean {\n    const newVal = this.args.disabled || false;\n    if (\n      this._previousDisabled !== UNINITIALIZED &&\n      this._previousDisabled !== newVal\n    ) {\n      // eslint-disable-next-line ember/no-runloop\n      schedule('actions', () => {\n        if (newVal && this.publicAPI.isOpen) {\n          // eslint-disable-next-line ember/no-side-effects\n          this.isOpen = false;\n        }\n        if (this.args.registerAPI) {\n          this.args.registerAPI(this.publicAPI);\n        }\n      });\n    }\n    // eslint-disable-next-line ember/no-side-effects\n    this._previousDisabled = newVal;\n    return newVal;\n  }\n\n  get publicAPI(): Dropdown {\n    return {\n      uniqueId: this._uid,\n      isOpen: this.isOpen,\n      disabled: this.disabled,\n      actions: this._actions,\n    };\n  }\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: BasicDropdownArgs) {\n    super(owner, args);\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n\n    if (this.args.dropdownId !== undefined) {\n      deprecate(\n        'You have passed `@dropdownId` into `ember-basic-dropdown`. This property does not work correctly without custom modifiers and is undocumented. Remove this parameter and use the `uniqueId` property from the public API instead.',\n        false,\n        {\n          for: 'ember-basic-dropdown',\n          id: 'ember-basic-dropdown.deprecate-arg-dropdown-id',\n          since: {\n            enabled: '8.8',\n            available: '8.8',\n          },\n          until: '9.0.0',\n        },\n      );\n    }\n  }\n\n  override willDestroy(): void {\n    super.willDestroy();\n    if (this.args.registerAPI) {\n      this.args.registerAPI(null);\n    }\n  }\n\n  // Actions\n  @action\n  open(e?: Event): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onOpen && this.args.onOpen(this.publicAPI, e) === false) {\n      return;\n    }\n    this.isOpen = true;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (trigger) {\n      const parent = trigger.parentElement;\n      if (parent) {\n        parent.setAttribute('aria-owns', this._dropdownId);\n      }\n    }\n  }\n\n  @action\n  close(e?: Event, skipFocus?: boolean): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || !this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onClose && this.args.onClose(this.publicAPI, e) === false) {\n      return;\n    }\n    if (this.isDestroyed) {\n      return; // To check that the `onClose` didn't destroy the dropdown\n    }\n    this.hPosition = this.vPosition = null;\n    this.top = this.left = this.right = this.width = this.height = undefined;\n    this.previousVerticalPosition = this.previousHorizontalPosition = undefined;\n    this.isOpen = false;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (!trigger) {\n      return;\n    }\n    const parent = trigger.parentElement;\n    if (parent) {\n      parent.removeAttribute('aria-owns');\n    }\n    if (skipFocus) {\n      return;\n    }\n    if (trigger.tabIndex > -1) {\n      trigger.focus();\n    }\n  }\n\n  @action\n  toggle(e?: Event): void {\n    if (this.publicAPI.isOpen) {\n      this.close(e);\n    } else {\n      this.open(e);\n    }\n  }\n\n  @action\n  reposition(): undefined | RepositionChanges {\n    if (!this.publicAPI.isOpen) {\n      return;\n    }\n    const dropdownElement = this._getDropdownElement();\n    const triggerElement = this._getTriggerElement();\n    if (!dropdownElement || !triggerElement || !this.destinationElement) {\n      return;\n    }\n\n    const {\n      horizontalPosition,\n      verticalPosition,\n      previousHorizontalPosition,\n      previousVerticalPosition,\n    } = this;\n    const { renderInPlace = false, matchTriggerWidth = false } = this.args;\n    const calculatePositionFn =\n      this.args.calculatePosition || calculatePosition;\n    const positionData = calculatePositionFn(\n      triggerElement,\n      dropdownElement,\n      this.destinationElement,\n      {\n        horizontalPosition,\n        verticalPosition,\n        previousHorizontalPosition,\n        previousVerticalPosition,\n        renderInPlace,\n        matchTriggerWidth,\n        dropdown: this,\n      },\n    );\n    return this.applyReposition(triggerElement, dropdownElement, positionData);\n  }\n\n  @action\n  registerTriggerElement(element: HTMLElement): void {\n    this.triggerElement = element;\n  }\n\n  @action\n  registerDropdownElement(element: HTMLElement): void {\n    this.dropdownElement = element;\n  }\n\n  applyReposition(\n    _trigger: Element,\n    dropdown: HTMLElement,\n    positions: CalculatePositionResult,\n  ): RepositionChanges {\n    const changes: RepositionChanges = {\n      hPosition: positions.horizontalPosition,\n      vPosition: positions.verticalPosition,\n      otherStyles: Object.assign({}, this.otherStyles),\n    };\n\n    if (positions.style) {\n      if (positions.style.top !== undefined) {\n        changes.top = `${positions.style.top}px`;\n      }\n      // The component can be aligned from the right or from the left, but not from both.\n      if (positions.style.left !== undefined) {\n        changes.left = `${positions.style.left}px`;\n        changes.right = undefined;\n        // Since we set the first run manually we may need to unset the `right` property.\n        if (positions.style.right !== undefined) {\n          positions.style.right = undefined;\n        }\n      } else if (positions.style.right !== undefined) {\n        changes.right = `${positions.style.right}px`;\n        changes.left = undefined;\n      }\n      if (positions.style.width !== undefined) {\n        changes.width = `${positions.style.width}px`;\n      }\n      if (positions.style.height !== undefined) {\n        changes.height = `${positions.style.height}px`;\n      }\n      if (this.top === undefined) {\n        // Bypass Ember on the first reposition only to avoid flickering.\n        for (const prop in positions.style) {\n          if (positions.style[prop] !== undefined) {\n            if (typeof positions.style[prop] === 'number') {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}px`);\n            } else {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}`);\n            }\n          }\n        }\n      }\n    }\n    for (const prop in positions.style) {\n      if (!IGNORED_STYLES.includes(prop)) {\n        changes.otherStyles[prop] = positions.style[prop];\n      }\n    }\n\n    this.hPosition = changes.hPosition;\n    this.vPosition = changes.vPosition;\n    this.top = changes.top;\n    this.left = changes.left;\n    this.right = changes.right;\n    this.width = changes.width;\n    this.height = changes.height;\n    this.otherStyles = changes.otherStyles;\n    this.previousHorizontalPosition = positions.horizontalPosition;\n    this.previousVerticalPosition = positions.verticalPosition;\n    return changes;\n  }\n\n  _getDestinationId(): string {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    const config = getOwner(this).resolveRegistration('config:environment') as {\n      environment: string;\n      APP: {\n        rootElement: string;\n      };\n      'ember-basic-dropdown': {\n        destination: string;\n      };\n    };\n\n    if (config.environment === 'test') {\n      // document doesn't exist in fastboot apps, for this reason we need this check\n      if (typeof document === 'undefined') {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // check if destination exists in tests:\n      if (\n        config['ember-basic-dropdown'] &&\n        config['ember-basic-dropdown'].destination\n      ) {\n        const destination = config['ember-basic-dropdown'].destination;\n        if (document.getElementById(destination) !== null) {\n          return destination;\n        }\n      }\n\n      // check if default element exists in tests:\n      if (document.getElementById('ember-basic-dropdown-wormhole') !== null) {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // fall back to rootElement as destination\n      const rootElement = config['APP']?.rootElement;\n      return (\n        document.querySelector(rootElement)?.id ??\n        'ember-basic-dropdown-wormhole'\n      );\n    }\n\n    return (\n      (config['ember-basic-dropdown'] &&\n        config['ember-basic-dropdown'].destination) ||\n      'ember-basic-dropdown-wormhole'\n    );\n  }\n\n  _getDropdownElement(): HTMLElement | null {\n    if (this.dropdownElement) {\n      return this.dropdownElement;\n    }\n\n    return document.querySelector(`[id=\"${this._dropdownId}\"]`);\n  }\n\n  _getTriggerElement(): HTMLElement | null {\n    if (this.triggerElement) {\n      return this.triggerElement;\n    }\n\n    return document.querySelector(\n      `[data-ebd-id=${this.publicAPI.uniqueId}-trigger]`,\n    );\n  }\n\n  get triggerComponent(): ComponentLike<BasicDropdownTriggerSignature> {\n    if (this.args.triggerComponent) {\n      return ensureSafeComponent(\n        this.args.triggerComponent,\n        this,\n      ) as ComponentLike<BasicDropdownTriggerSignature>;\n    }\n\n    return BasicDropdownTrigger as ComponentLike<BasicDropdownTriggerSignature>;\n  }\n\n  get contentComponent(): ComponentLike<BasicDropdownContentSignature> {\n    if (this.args.contentComponent) {\n      return ensureSafeComponent(\n        this.args.contentComponent,\n        this,\n      ) as ComponentLike<BasicDropdownContentSignature>;\n    }\n\n    return BasicDropdownContent as ComponentLike<BasicDropdownContentSignature>;\n  }\n\n  <template>\n    {{#let\n      (hash\n        uniqueId=this.publicAPI.uniqueId\n        isOpen=this.publicAPI.isOpen\n        disabled=this.publicAPI.disabled\n        actions=this.publicAPI.actions\n        Trigger=(component\n          this.triggerComponent\n          dropdown=this.publicAPI\n          hPosition=this.hPosition\n          renderInPlace=this.renderInPlace\n          vPosition=this.vPosition\n        )\n        Content=(component\n          this.contentComponent\n          dropdown=this.publicAPI\n          hPosition=this.hPosition\n          renderInPlace=this.renderInPlace\n          preventScroll=@preventScroll\n          rootEventType=(or @rootEventType \"click\")\n          vPosition=this.vPosition\n          destination=this.destination\n          destinationElement=this.destinationElement\n          top=this.top\n          left=this.left\n          right=this.right\n          width=this.width\n          height=this.height\n          otherStyles=this.otherStyles\n        )\n      )\n      as |api|\n    }}\n      {{#if this.renderInPlace}}\n        <div class=\"ember-basic-dropdown\" ...attributes>{{yield api}}</div>\n      {{else}}\n        {{yield api}}\n      {{/if}}\n    {{/let}}\n  </template>\n}\n"],"names":["UNINITIALIZED","IGNORED_STYLES","BasicDropdown","Component","g","prototype","tracked","i","void 0","args","initiallyOpened","renderInPlace","undefined","previousVerticalPosition","previousHorizontalPosition","triggerElement","dropdownElement","_uid","guidFor","_dropdownId","dropdownId","_previousDisabled","_actions","open","bind","close","toggle","reposition","registerTriggerElement","registerDropdownElement","getTriggerElement","horizontalPosition","verticalPosition","destination","_getDestinationId","destinationElement","element","document","getElementById","getRootNode","ShadowRoot","querySelector","disabled","newVal","schedule","publicAPI","isOpen","registerAPI","uniqueId","actions","constructor","owner","onInit","deprecate","for","id","since","enabled","available","until","willDestroy","e","isDestroyed","onOpen","trigger","_getTriggerElement","parent","parentElement","setAttribute","n","action","skipFocus","onClose","hPosition","vPosition","top","left","right","width","height","removeAttribute","tabIndex","focus","_getDropdownElement","matchTriggerWidth","calculatePositionFn","calculatePosition","positionData","dropdown","applyReposition","_trigger","positions","changes","otherStyles","Object","assign","style","prop","setProperty","includes","config","getOwner","resolveRegistration","environment","rootElement","triggerComponent","ensureSafeComponent","BasicDropdownTrigger","contentComponent","BasicDropdownContent","setComponentTemplate","precompileTemplate","strictMode","scope","hash","or"],"mappings":"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"}