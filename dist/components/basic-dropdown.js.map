{"version":3,"file":"basic-dropdown.js","sources":["../../src/components/basic-dropdown.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport calculatePosition from '../utils/calculate-position.ts';\nimport { schedule } from '@ember/runloop';\nimport { hash } from '@ember/helper';\nimport BasicDropdownTrigger from './basic-dropdown-trigger.gts';\nimport BasicDropdownContent from './basic-dropdown-content.gts';\nimport { or } from 'ember-truth-helpers';\nimport { isTesting } from '@embroider/macros';\nimport { getConfig } from '../config.ts';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type {\n  CalculatePosition,\n  CalculatePositionResult,\n  HorizontalPosition,\n  VerticalPosition,\n} from '../utils/calculate-position.ts';\nimport type { BasicDropdownTriggerSignature } from './basic-dropdown-trigger.gts';\nimport type { BasicDropdownContentSignature } from './basic-dropdown-content.gts';\nimport type {\n  Dropdown,\n  DropdownActions,\n  RepositionChanges,\n  TRootEventType,\n} from '../types.ts';\n\nconst UNINITIALIZED = {};\nconst IGNORED_STYLES = ['top', 'left', 'right', 'width', 'height'];\n\nexport interface BasicDropdownDefaultBlock<\n  TriggerHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n  ContentHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n> {\n  uniqueId: string;\n  disabled: boolean;\n  isOpen: boolean;\n  actions: DropdownActions;\n  Trigger: ComponentLike<\n    Omit<BasicDropdownTriggerSignature<TriggerHtmlTag>, 'Args'> & {\n      Args: Omit<\n        BasicDropdownTriggerSignature<TriggerHtmlTag>['Args'],\n        'htmlTag' | 'dropdown' | 'hPosition' | 'vPosition' | 'renderInPlace'\n      >;\n    }\n  >;\n  Content: ComponentLike<\n    Omit<BasicDropdownContentSignature<ContentHtmlTag>, 'Args'> & {\n      Args: Omit<\n        BasicDropdownContentSignature<ContentHtmlTag>['Args'],\n        | 'htmlTag'\n        | 'dropdown'\n        | 'hPosition'\n        | 'vPosition'\n        | 'renderInPlace'\n        | 'destination'\n        | 'destinationElement'\n        | 'top'\n        | 'left'\n        | 'right'\n        | 'width'\n        | 'height'\n        | 'otherStyles'\n        | 'preventScroll'\n        | 'rootEventType'\n      >;\n    }\n  >;\n}\n\nexport interface BasicDropdownSignature<\n  TriggerHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n  ContentHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n> {\n  Element: HTMLElement;\n  Args: BasicDropdownArgs<TriggerHtmlTag, ContentHtmlTag>;\n  Blocks: {\n    default: [BasicDropdownDefaultBlock<TriggerHtmlTag, ContentHtmlTag>];\n  };\n}\n\nexport interface BasicDropdownArgs<\n  TriggerHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n  ContentHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n> {\n  initiallyOpened?: boolean;\n  renderInPlace?: boolean;\n  verticalPosition?: VerticalPosition;\n  horizontalPosition?: HorizontalPosition;\n  destination?: string;\n  destinationElement?: HTMLElement;\n  disabled?: boolean;\n  rootEventType?: TRootEventType;\n  preventScroll?: boolean;\n  matchTriggerWidth?: boolean;\n  triggerHtmlTag?: TriggerHtmlTag;\n  contentHtmlTag?: ContentHtmlTag;\n  onInit?: (dropdown: Dropdown) => void;\n  registerAPI?: (dropdown: Dropdown | null) => void;\n  onOpen?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  onClose?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  triggerComponent?:\n    | ComponentLike<BasicDropdownTriggerSignature<TriggerHtmlTag>>\n    | undefined;\n  contentComponent?:\n    | ComponentLike<BasicDropdownContentSignature<ContentHtmlTag>>\n    | undefined;\n  calculatePosition?: CalculatePosition;\n}\n\nexport default class BasicDropdown<\n  TriggerHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n  ContentHtmlTag extends keyof HTMLElementTagNameMap = 'div',\n> extends Component<BasicDropdownSignature<TriggerHtmlTag, ContentHtmlTag>> {\n  @tracked hPosition: HorizontalPosition | null = null;\n  @tracked vPosition: VerticalPosition | null = null;\n  @tracked top: string | undefined;\n  @tracked left: string | undefined;\n  @tracked right: string | undefined;\n  @tracked width: string | undefined;\n  @tracked height: string | undefined;\n  @tracked otherStyles: Record<string, string | number | undefined> = {};\n  @tracked isOpen = this.args.initiallyOpened || false;\n  @tracked renderInPlace =\n    this.args.renderInPlace !== undefined ? this.args.renderInPlace : false;\n  private previousVerticalPosition?: VerticalPosition | undefined;\n  private previousHorizontalPosition?: HorizontalPosition | undefined;\n  private triggerElement: HTMLElement | null = null;\n  private dropdownElement: HTMLElement | null = null;\n\n  private _uid = guidFor(this);\n  private _dropdownId: string = `ember-basic-dropdown-content-${this._uid}`;\n  private _previousDisabled = UNINITIALIZED;\n  private _actions: DropdownActions = {\n    open: this.open.bind(this),\n    close: this.close.bind(this),\n    toggle: this.toggle.bind(this),\n    reposition: this.reposition.bind(this),\n    registerTriggerElement: this.registerTriggerElement.bind(this),\n    registerDropdownElement: this.registerDropdownElement.bind(this),\n    getTriggerElement: () => this.triggerElement,\n  };\n\n  private get horizontalPosition() {\n    return this.args.horizontalPosition || 'auto'; // auto-right | right | center | left\n  }\n\n  private get verticalPosition() {\n    return this.args.verticalPosition || 'auto'; // above | below\n  }\n\n  get destination(): string {\n    return this.args.destination || this._getDestinationId();\n  }\n\n  get destinationElement(): HTMLElement | null {\n    if (this.args.destinationElement) {\n      return this.args.destinationElement;\n    }\n\n    const element = document.getElementById(this.destination);\n\n    if (element) {\n      return element;\n    }\n\n    if (\n      this.triggerElement &&\n      this.triggerElement.getRootNode() instanceof ShadowRoot\n    ) {\n      return (this.triggerElement.getRootNode() as HTMLElement)?.querySelector(\n        `#${this.destination}`,\n      );\n    }\n\n    return null;\n  }\n\n  get disabled(): boolean {\n    const newVal = this.args.disabled || false;\n    if (\n      this._previousDisabled !== UNINITIALIZED &&\n      this._previousDisabled !== newVal\n    ) {\n      // eslint-disable-next-line ember/no-runloop\n      schedule('actions', () => {\n        if (newVal && this.publicAPI.isOpen) {\n          // eslint-disable-next-line ember/no-side-effects\n          this.isOpen = false;\n        }\n        if (this.args.registerAPI) {\n          this.args.registerAPI(this.publicAPI);\n        }\n      });\n    }\n    // eslint-disable-next-line ember/no-side-effects\n    this._previousDisabled = newVal;\n    return newVal;\n  }\n\n  get publicAPI(): Dropdown {\n    return {\n      uniqueId: this._uid,\n      isOpen: this.isOpen,\n      disabled: this.disabled,\n      actions: this._actions,\n    };\n  }\n\n  // Lifecycle hooks\n  constructor(\n    owner: Owner,\n    args: BasicDropdownArgs<TriggerHtmlTag, ContentHtmlTag>,\n  ) {\n    super(owner, args);\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n  }\n\n  override willDestroy(): void {\n    super.willDestroy();\n    if (this.args.registerAPI) {\n      this.args.registerAPI(null);\n    }\n  }\n\n  // Actions\n  @action\n  open(e?: Event): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onOpen && this.args.onOpen(this.publicAPI, e) === false) {\n      return;\n    }\n    this.isOpen = true;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (trigger) {\n      const parent = trigger.parentElement;\n      if (parent) {\n        parent.setAttribute('aria-owns', this._dropdownId);\n      }\n    }\n  }\n\n  @action\n  close(e?: Event, skipFocus?: boolean): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || !this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onClose && this.args.onClose(this.publicAPI, e) === false) {\n      return;\n    }\n    if (this.isDestroyed) {\n      return; // To check that the `onClose` didn't destroy the dropdown\n    }\n    this.hPosition = this.vPosition = null;\n    this.top = this.left = this.right = this.width = this.height = undefined;\n    this.previousVerticalPosition = this.previousHorizontalPosition = undefined;\n    this.isOpen = false;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (!trigger) {\n      return;\n    }\n    const parent = trigger.parentElement;\n    if (parent) {\n      parent.removeAttribute('aria-owns');\n    }\n    if (skipFocus) {\n      return;\n    }\n    if (trigger.tabIndex > -1) {\n      trigger.focus();\n    }\n  }\n\n  @action\n  toggle(e?: Event): void {\n    if (this.publicAPI.isOpen) {\n      this.close(e);\n    } else {\n      this.open(e);\n    }\n  }\n\n  @action\n  reposition(): undefined | RepositionChanges {\n    if (!this.publicAPI.isOpen) {\n      return;\n    }\n    const dropdownElement = this._getDropdownElement();\n    const triggerElement = this._getTriggerElement();\n    if (!dropdownElement || !triggerElement || !this.destinationElement) {\n      return;\n    }\n\n    const {\n      horizontalPosition,\n      verticalPosition,\n      previousHorizontalPosition,\n      previousVerticalPosition,\n    } = this;\n    const { renderInPlace = false, matchTriggerWidth = false } = this.args;\n    const calculatePositionFn =\n      this.args.calculatePosition || calculatePosition;\n    const positionData = calculatePositionFn(\n      triggerElement,\n      dropdownElement,\n      this.destinationElement,\n      {\n        horizontalPosition,\n        verticalPosition,\n        previousHorizontalPosition,\n        previousVerticalPosition,\n        renderInPlace,\n        matchTriggerWidth,\n      },\n    );\n    return this.applyReposition(triggerElement, dropdownElement, positionData);\n  }\n\n  @action\n  registerTriggerElement(element: HTMLElement): void {\n    this.triggerElement = element;\n  }\n\n  @action\n  registerDropdownElement(element: HTMLElement): void {\n    this.dropdownElement = element;\n  }\n\n  applyReposition(\n    _trigger: Element,\n    dropdown: HTMLElement,\n    positions: CalculatePositionResult,\n  ): RepositionChanges {\n    const changes: RepositionChanges = {\n      hPosition: positions.horizontalPosition,\n      vPosition: positions.verticalPosition,\n      otherStyles: Object.assign({}, this.otherStyles),\n    };\n\n    if (positions.style) {\n      if (positions.style.top !== undefined) {\n        changes.top = `${positions.style.top}px`;\n      }\n      // The component can be aligned from the right or from the left, but not from both.\n      if (positions.style.left !== undefined) {\n        changes.left = `${positions.style.left}px`;\n        changes.right = undefined;\n        // Since we set the first run manually we may need to unset the `right` property.\n        if (positions.style.right !== undefined) {\n          positions.style.right = undefined;\n        }\n      } else if (positions.style.right !== undefined) {\n        changes.right = `${positions.style.right}px`;\n        changes.left = undefined;\n      }\n      if (positions.style.width !== undefined) {\n        changes.width = `${positions.style.width}px`;\n      }\n      if (positions.style.height !== undefined) {\n        changes.height = `${positions.style.height}px`;\n      }\n      if (this.top === undefined) {\n        // Bypass Ember on the first reposition only to avoid flickering.\n        for (const prop in positions.style) {\n          if (positions.style[prop] !== undefined) {\n            if (typeof positions.style[prop] === 'number') {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}px`);\n            } else {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}`);\n            }\n          }\n        }\n      }\n    }\n    for (const prop in positions.style) {\n      if (!IGNORED_STYLES.includes(prop)) {\n        changes.otherStyles[prop] = positions.style[prop];\n      }\n    }\n\n    this.hPosition = changes.hPosition;\n    this.vPosition = changes.vPosition;\n    this.top = changes.top;\n    this.left = changes.left;\n    this.right = changes.right;\n    this.width = changes.width;\n    this.height = changes.height;\n    this.otherStyles = changes.otherStyles;\n    this.previousHorizontalPosition = positions.horizontalPosition;\n    this.previousVerticalPosition = positions.verticalPosition;\n    return changes;\n  }\n\n  _getDestinationId(): string {\n    const config = getConfig();\n\n    if (isTesting()) {\n      // document doesn't exist in fastboot apps, for this reason we need this check\n      if (typeof document === 'undefined') {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // check if destination exists in tests:\n      if (config.destination) {\n        const destination = config.destination;\n        if (document.getElementById(destination) !== null) {\n          return destination;\n        }\n      }\n\n      // check if default element exists in tests:\n      if (document.getElementById('ember-basic-dropdown-wormhole') !== null) {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // fall back to rootElement as destination\n      const rootElement = config.rootElement;\n      return (\n        (rootElement ? document.querySelector(rootElement)?.id : undefined) ??\n        'ember-basic-dropdown-wormhole'\n      );\n    }\n\n    return config.destination || 'ember-basic-dropdown-wormhole';\n  }\n\n  _getDropdownElement(): HTMLElement | null {\n    if (this.dropdownElement) {\n      return this.dropdownElement;\n    }\n\n    return document.querySelector(`[id=\"${this._dropdownId}\"]`);\n  }\n\n  _getTriggerElement(): HTMLElement | null {\n    if (this.triggerElement) {\n      return this.triggerElement;\n    }\n\n    return document.querySelector(\n      `[data-ebd-id=${this.publicAPI.uniqueId}-trigger]`,\n    );\n  }\n\n  get triggerComponent(): ComponentLike<\n    BasicDropdownTriggerSignature<TriggerHtmlTag>\n  > {\n    return (\n      this.args.triggerComponent ||\n      (BasicDropdownTrigger as ComponentLike<\n        BasicDropdownTriggerSignature<TriggerHtmlTag>\n      >)\n    );\n  }\n\n  get contentComponent(): ComponentLike<\n    BasicDropdownContentSignature<ContentHtmlTag>\n  > {\n    return (\n      this.args.contentComponent ||\n      (BasicDropdownContent as ComponentLike<\n        BasicDropdownContentSignature<ContentHtmlTag>\n      >)\n    );\n  }\n\n  <template>\n    {{#let\n      (hash\n        uniqueId=this.publicAPI.uniqueId\n        isOpen=this.publicAPI.isOpen\n        disabled=this.publicAPI.disabled\n        actions=this.publicAPI.actions\n        Trigger=(component\n          this.triggerComponent\n          dropdown=this.publicAPI\n          hPosition=this.hPosition\n          renderInPlace=this.renderInPlace\n          vPosition=this.vPosition\n          htmlTag=@triggerHtmlTag\n        )\n        Content=(component\n          this.contentComponent\n          dropdown=this.publicAPI\n          hPosition=this.hPosition\n          renderInPlace=this.renderInPlace\n          preventScroll=@preventScroll\n          rootEventType=(or @rootEventType \"click\")\n          vPosition=this.vPosition\n          htmlTag=@contentHtmlTag\n          destination=this.destination\n          destinationElement=this.destinationElement\n          top=this.top\n          left=this.left\n          right=this.right\n          width=this.width\n          height=this.height\n          otherStyles=this.otherStyles\n        )\n      )\n      as |api|\n    }}\n      {{#if this.renderInPlace}}\n        <div class=\"ember-basic-dropdown\" ...attributes>{{yield api}}</div>\n      {{else}}\n        {{yield api}}\n      {{/if}}\n    {{/let}}\n  </template>\n}\n"],"names":["UNINITIALIZED","IGNORED_STYLES","BasicDropdown","Component","g","prototype","tracked","i","void 0","args","initiallyOpened","renderInPlace","undefined","previousVerticalPosition","previousHorizontalPosition","triggerElement","dropdownElement","_uid","guidFor","_dropdownId","_previousDisabled","_actions","open","bind","close","toggle","reposition","registerTriggerElement","registerDropdownElement","getTriggerElement","horizontalPosition","verticalPosition","destination","_getDestinationId","destinationElement","element","document","getElementById","getRootNode","ShadowRoot","querySelector","disabled","newVal","schedule","publicAPI","isOpen","registerAPI","uniqueId","actions","constructor","owner","onInit","willDestroy","e","isDestroyed","onOpen","trigger","_getTriggerElement","parent","parentElement","setAttribute","n","action","skipFocus","onClose","hPosition","vPosition","top","left","right","width","height","removeAttribute","tabIndex","focus","_getDropdownElement","matchTriggerWidth","calculatePositionFn","calculatePosition","positionData","applyReposition","_trigger","dropdown","positions","changes","otherStyles","Object","assign","style","prop","setProperty","includes","config","getConfig","isTesting","rootElement","id","triggerComponent","BasicDropdownTrigger","contentComponent","BasicDropdownContent","setComponentTemplate","precompileTemplate","strictMode","scope","hash","or"],"mappings":"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"}