{"version":3,"file":"calculate-position.js","sources":["../../src/utils/calculate-position.ts"],"sourcesContent":["import type { VerticalPosition, HorizontalPosition } from '../types.ts';\n\n// To avoid breaking the current types export we need this\nexport type { VerticalPosition, HorizontalPosition };\n\nexport interface CalculatePositionOptions {\n  horizontalPosition: HorizontalPosition;\n  verticalPosition: VerticalPosition;\n  matchTriggerWidth: boolean;\n  previousHorizontalPosition?: HorizontalPosition | undefined;\n  previousVerticalPosition?: VerticalPosition | undefined;\n  renderInPlace: boolean;\n}\n\nexport type CalculatePositionResultStyle = {\n  top?: number | undefined;\n  left?: number | undefined;\n  right?: number | undefined;\n  width?: number | undefined;\n  height?: number | undefined;\n  [key: string]: string | number | undefined;\n};\n\nexport type CalculatePositionResult = {\n  horizontalPosition: HorizontalPosition;\n  verticalPosition: VerticalPosition;\n  style: CalculatePositionResultStyle;\n};\n\nexport type CalculatePosition = (\n  trigger: HTMLElement,\n  content: HTMLElement,\n  destination: HTMLElement,\n  options: CalculatePositionOptions,\n) => CalculatePositionResult;\n\ntype GetViewDataResult = {\n  scroll: { left: number; top: number };\n  triggerLeft: number;\n  triggerTop: number;\n  triggerWidth: number;\n  triggerHeight: number;\n  dropdownHeight: number;\n  dropdownWidth: number;\n  viewportWidth: number;\n  viewportBottom: number;\n};\n\ntype GetViewData = (\n  trigger: Element,\n  content: HTMLElement,\n  renderInPlace: boolean,\n) => GetViewDataResult;\n\nconst getViewData: GetViewData = (trigger, content, renderInPlace) => {\n  let scroll = { left: window.pageXOffset, top: window.pageYOffset };\n  if (renderInPlace) {\n    scroll = {\n      left: window.scrollX,\n      top: window.scrollY,\n    };\n  }\n\n  const {\n    left: triggerLeft,\n    top: triggerTop,\n    width: triggerWidth,\n    height: triggerHeight,\n  } = trigger.getBoundingClientRect();\n  const { height: dropdownHeight, width: dropdownWidth } =\n    content.getBoundingClientRect();\n  const viewportWidth = document.body.clientWidth || window.innerWidth;\n  const viewportBottom = scroll.top + window.innerHeight;\n\n  return {\n    scroll,\n    // The properties top and left of the trigger client rectangle need to be absolute to\n    // the top left corner of the document as the value it's compared to is also the total\n    // height and not only the viewport height (window client height + scroll offset).\n    triggerLeft: triggerLeft + (renderInPlace ? window.scrollX : 0),\n    triggerTop: triggerTop + (renderInPlace ? window.scrollY : 0),\n    triggerWidth,\n    triggerHeight,\n    dropdownHeight,\n    dropdownWidth,\n    viewportWidth,\n    viewportBottom,\n  };\n};\n\nexport function calculateWormholedPosition(\n  trigger: HTMLElement,\n  content: HTMLElement,\n  destination: HTMLElement,\n  {\n    horizontalPosition,\n    verticalPosition,\n    matchTriggerWidth,\n    previousHorizontalPosition,\n    previousVerticalPosition,\n  }: CalculatePositionOptions,\n): CalculatePositionResult {\n  // Collect information about all the involved DOM elements\n  const viewData = getViewData(trigger, content, false);\n  const {\n    scroll,\n    triggerWidth,\n    triggerHeight,\n    dropdownHeight,\n    viewportWidth,\n    viewportBottom,\n  } = viewData;\n  let { triggerLeft, triggerTop, dropdownWidth } = viewData;\n  const style: CalculatePositionResultStyle = {};\n\n  // Apply containers' offset\n  let anchorElement = destination.parentNode as HTMLElement;\n\n  if (anchorElement instanceof ShadowRoot) {\n    anchorElement = anchorElement.host as HTMLElement;\n  }\n\n  let anchorPosition = window.getComputedStyle(anchorElement).position;\n  while (\n    anchorPosition !== 'relative' &&\n    anchorPosition !== 'absolute' &&\n    anchorElement.tagName.toUpperCase() !== 'BODY' &&\n    !(anchorElement.parentNode instanceof ShadowRoot)\n  ) {\n    anchorElement = anchorElement.parentNode as HTMLElement;\n    anchorPosition = window.getComputedStyle(anchorElement).position;\n  }\n  if (anchorPosition === 'relative' || anchorPosition === 'absolute') {\n    const rect = anchorElement.getBoundingClientRect();\n    triggerLeft = triggerLeft - rect.left;\n    triggerTop = triggerTop - rect.top;\n    const { offsetParent } = anchorElement;\n    if (offsetParent) {\n      triggerLeft -= offsetParent.scrollLeft;\n      triggerTop -= offsetParent.scrollTop;\n    }\n  }\n\n  // Calculate drop down width\n  dropdownWidth = matchTriggerWidth ? triggerWidth : dropdownWidth;\n  if (matchTriggerWidth) {\n    style.width = dropdownWidth;\n  }\n\n  /**\n   * Fixes bug where the dropdown always stays on the same position on the screen when\n   * the <body> is relatively positioned\n   */\n  const isBodyPositionRelative =\n    window.getComputedStyle(document.body).getPropertyValue('position') ===\n    'relative';\n\n  // Calculate horizontal position\n  let triggerLeftWithScroll = triggerLeft;\n\n  if (!isBodyPositionRelative) {\n    triggerLeftWithScroll += scroll.left;\n  }\n\n  if (horizontalPosition === 'auto' || horizontalPosition === 'auto-left') {\n    // Calculate the number of visible horizontal pixels if we were to place the\n    // dropdown on the left and right\n    const leftVisible =\n      Math.min(viewportWidth, triggerLeft + dropdownWidth) -\n      Math.max(0, triggerLeft);\n    const rightVisible =\n      Math.min(viewportWidth, triggerLeft + triggerWidth) -\n      Math.max(0, triggerLeft + triggerWidth - dropdownWidth);\n\n    if (dropdownWidth > leftVisible && rightVisible > leftVisible) {\n      // If the drop down won't fit left-aligned, and there is more space on the\n      // right than on the left, then force right-aligned\n      horizontalPosition = 'right';\n    } else if (dropdownWidth > rightVisible && leftVisible > rightVisible) {\n      // If the drop down won't fit right-aligned, and there is more space on\n      // the left than on the right, then force left-aligned\n      horizontalPosition = 'left';\n    } else {\n      // Keep same position as previous\n      horizontalPosition = previousHorizontalPosition || 'left';\n    }\n  } else if (horizontalPosition === 'auto-right') {\n    // Calculate the number of visible horizontal pixels if we were to place the\n    // dropdown on the left and right\n    const leftVisible =\n      Math.min(viewportWidth, triggerLeft + dropdownWidth) -\n      Math.max(0, triggerLeft);\n    const rightVisible =\n      Math.min(viewportWidth, triggerLeft + triggerWidth) -\n      Math.max(0, triggerLeft + triggerWidth - dropdownWidth);\n\n    if (dropdownWidth > rightVisible && leftVisible > rightVisible) {\n      // If the drop down won't fit right-aligned, and there is more space on the\n      // left than on the right, then force left-aligned\n      horizontalPosition = 'left';\n    } else if (dropdownWidth > leftVisible && rightVisible > leftVisible) {\n      // If the drop down won't fit left-aligned, and there is more space on\n      // the right than on the left, then force right-aligned\n      horizontalPosition = 'right';\n    } else {\n      // Keep same position as previous\n      horizontalPosition = previousHorizontalPosition || 'right';\n    }\n  }\n  if (horizontalPosition === 'right') {\n    style.right = viewportWidth - (triggerLeftWithScroll + triggerWidth);\n  } else if (horizontalPosition === 'center') {\n    style.left = triggerLeftWithScroll + (triggerWidth - dropdownWidth) / 2;\n  } else {\n    style.left = triggerLeftWithScroll;\n  }\n\n  // Calculate vertical position\n  let triggerTopWithScroll = triggerTop;\n\n  if (!isBodyPositionRelative) {\n    triggerTopWithScroll += scroll.top;\n  }\n\n  if (verticalPosition === 'above') {\n    style.top = triggerTopWithScroll - dropdownHeight;\n  } else if (verticalPosition === 'below') {\n    style.top = triggerTopWithScroll + triggerHeight;\n  } else {\n    const enoughRoomBelow =\n      triggerTopWithScroll + triggerHeight + dropdownHeight < viewportBottom;\n    const enoughRoomAbove = triggerTop > dropdownHeight;\n\n    if (!enoughRoomBelow && !enoughRoomAbove) {\n      verticalPosition = 'below';\n    } else if (\n      previousVerticalPosition === 'below' &&\n      !enoughRoomBelow &&\n      enoughRoomAbove\n    ) {\n      verticalPosition = 'above';\n    } else if (\n      previousVerticalPosition === 'above' &&\n      !enoughRoomAbove &&\n      enoughRoomBelow\n    ) {\n      verticalPosition = 'below';\n    } else if (!previousVerticalPosition) {\n      verticalPosition = enoughRoomBelow ? 'below' : 'above';\n    } else {\n      verticalPosition = previousVerticalPosition;\n    }\n    style.top =\n      triggerTopWithScroll +\n      (verticalPosition === 'below' ? triggerHeight : -dropdownHeight);\n  }\n\n  return { horizontalPosition, verticalPosition, style };\n}\n\nexport function calculateInPlacePosition(\n  trigger: HTMLElement,\n  content: HTMLElement,\n  _destination: HTMLElement,\n  { horizontalPosition, verticalPosition }: CalculatePositionOptions,\n): CalculatePositionResult {\n  let dropdownRect;\n  const positionData: CalculatePositionResult = {\n    horizontalPosition: 'left',\n    verticalPosition: 'below',\n    style: {},\n  };\n  if (horizontalPosition === 'auto') {\n    const triggerRect = trigger.getBoundingClientRect();\n    dropdownRect = content.getBoundingClientRect();\n    const viewportRight = window.pageXOffset + window.innerWidth;\n    positionData.horizontalPosition =\n      triggerRect.left + dropdownRect.width > viewportRight ? 'right' : 'left';\n  } else if (horizontalPosition === 'center') {\n    const { width: triggerWidth } = trigger.getBoundingClientRect();\n    const { width: dropdownWidth } = content.getBoundingClientRect();\n    positionData.style = { left: (triggerWidth - dropdownWidth) / 2 };\n  } else if (horizontalPosition === 'auto-right') {\n    const triggerRect = trigger.getBoundingClientRect();\n    const dropdownRect = content.getBoundingClientRect();\n    positionData.horizontalPosition =\n      triggerRect.right > dropdownRect.width ? 'right' : 'left';\n  } else if (horizontalPosition === 'right') {\n    positionData.horizontalPosition = 'right';\n  }\n\n  if (verticalPosition === 'above') {\n    positionData.verticalPosition = verticalPosition;\n    dropdownRect = dropdownRect || content.getBoundingClientRect();\n    positionData.style.top = -dropdownRect.height;\n  } else if (verticalPosition === 'below') {\n    positionData.verticalPosition = 'below';\n  } else {\n    // Automatically determine if there is enough space above or below\n    const { triggerTop, triggerHeight, dropdownHeight, viewportBottom } =\n      getViewData(trigger, content, true);\n\n    const enoughRoomBelow =\n      triggerTop + triggerHeight + dropdownHeight < viewportBottom;\n    const enoughRoomAbove = triggerTop > dropdownHeight;\n\n    if (enoughRoomBelow) {\n      verticalPosition = 'below';\n    } else if (enoughRoomAbove) {\n      verticalPosition = 'above';\n      dropdownRect = dropdownRect || content.getBoundingClientRect();\n      positionData.style.top = -dropdownRect.height;\n    } else {\n      // Not enough space above or below\n      verticalPosition = 'below';\n    }\n    positionData.verticalPosition = verticalPosition;\n  }\n  return positionData;\n}\n\nexport function getScrollParent(element: Element) {\n  let style = window.getComputedStyle(element);\n  const excludeStaticParent = style.position === 'absolute';\n  const overflowRegex = /(auto|scroll)/;\n\n  if (style.position === 'fixed') return document.body;\n  for (\n    let parent: Element | null = element;\n    (parent = parent.parentElement);\n  ) {\n    style = window.getComputedStyle(parent);\n    if (excludeStaticParent && style.position === 'static') {\n      continue;\n    }\n    if (\n      overflowRegex.test(style.overflow + style.overflowY + style.overflowX)\n    ) {\n      return parent;\n    }\n  }\n\n  return document.body;\n}\n\nfunction calculatePosition(\n  trigger: HTMLElement,\n  content: HTMLElement,\n  destination: HTMLElement,\n  options: CalculatePositionOptions,\n): CalculatePositionResult {\n  if (options.renderInPlace) {\n    return calculateInPlacePosition(trigger, content, destination, options);\n  } else {\n    return calculateWormholedPosition(trigger, content, destination, options);\n  }\n}\n\nexport default calculatePosition;\n"],"names":["getViewData","trigger","content","renderInPlace","scroll","left","window","pageXOffset","top","pageYOffset","scrollX","scrollY","triggerLeft","triggerTop","width","triggerWidth","height","triggerHeight","getBoundingClientRect","dropdownHeight","dropdownWidth","viewportWidth","document","body","clientWidth","innerWidth","viewportBottom","innerHeight","calculateWormholedPosition","destination","horizontalPosition","verticalPosition","matchTriggerWidth","previousHorizontalPosition","previousVerticalPosition","viewData","style","anchorElement","parentNode","ShadowRoot","host","anchorPosition","getComputedStyle","position","tagName","toUpperCase","rect","offsetParent","scrollLeft","scrollTop","isBodyPositionRelative","getPropertyValue","triggerLeftWithScroll","leftVisible","Math","min","max","rightVisible","right","triggerTopWithScroll","enoughRoomBelow","enoughRoomAbove","calculateInPlacePosition","_destination","dropdownRect","positionData","triggerRect","viewportRight","getScrollParent","element","excludeStaticParent","overflowRegex","parent","parentElement","test","overflow","overflowY","overflowX","calculatePosition","options"],"mappings":"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"}