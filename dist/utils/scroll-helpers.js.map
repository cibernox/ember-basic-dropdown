{"version":3,"file":"scroll-helpers.js","sources":["../../src/utils/scroll-helpers.ts"],"sourcesContent":["interface ScrollDeltas {\n  deltaX: number;\n  deltaY: number;\n}\ninterface ScrollInformation {\n  element: Element;\n  scrollLeft: number;\n  scrollTop: number;\n}\n\n/**\n * Mode that expresses the deltas in pixels.\n */\nexport const DOM_DELTA_PIXEL = 0;\n/**\n * Mode that expresses the deltas in lines.\n *\n * This only happens in Firefox for Windows.\n *\n * Reference: https://stackoverflow.com/a/37474225\n */\nexport const DOM_DELTA_LINE = 1;\n/**\n * Mode that expresses the deltas in pages.\n *\n * This only happens in Firefox for Windows with\n * a custom OS setting activated.\n *\n * Reference: https://stackoverflow.com/a/37474225\n */\nexport const DOM_DELTA_PAGE = 2;\n\n/**\n * Number of lines per page considered for\n * DOM_DELTA_PAGE.\n *\n */\nexport const LINES_PER_PAGE = 3;\n\nlet scrollLineHeight: number | undefined = undefined;\n\nexport function getScrollDeltas({\n  deltaX = 0,\n  deltaY = 0,\n  deltaMode = DOM_DELTA_PIXEL,\n}): ScrollDeltas {\n  if (deltaMode !== DOM_DELTA_PIXEL) {\n    if (deltaMode === DOM_DELTA_PAGE) {\n      deltaX *= LINES_PER_PAGE;\n      deltaY *= LINES_PER_PAGE;\n    }\n    const scrollLineHeight = getScrollLineHeight();\n    if (scrollLineHeight !== undefined) {\n      deltaX *= scrollLineHeight;\n      deltaY *= scrollLineHeight;\n    }\n  }\n\n  return { deltaX, deltaY };\n}\n\nexport function getScrollLineHeight(): number | undefined {\n  if (scrollLineHeight === undefined) {\n    const iframe = document.createElement('iframe');\n    iframe.src = '#';\n    iframe.style.position = 'absolute';\n    iframe.style.visibility = 'hidden';\n    iframe.style.width = '0px';\n    iframe.style.height = '0px';\n    iframe.style.border = 'none';\n    document.body.appendChild(iframe);\n    const iframeDocument = (iframe.contentWindow as Window).document;\n    iframeDocument.open();\n    iframeDocument.write(\n      '<!doctype html><html><head></head><body><span>X</span></body></html>',\n    );\n    iframeDocument.close();\n    const body = iframeDocument.body;\n    scrollLineHeight = (body.firstElementChild as HTMLElement).offsetHeight;\n    document.body.removeChild(iframe);\n  }\n  return scrollLineHeight;\n}\n\nexport function getAvailableScroll(element: Element, container: Element) {\n  const availableScroll = {\n    deltaXNegative: 0,\n    deltaXPositive: 0,\n    deltaYNegative: 0,\n    deltaYPositive: 0,\n  };\n\n  let scrollLeftMax, scrollTopMax;\n  while (container.contains(element) || container === element) {\n    scrollLeftMax = element.scrollWidth - element.clientWidth;\n    scrollTopMax = element.scrollHeight - element.clientHeight;\n\n    availableScroll.deltaXNegative += -element.scrollLeft;\n    availableScroll.deltaXPositive += scrollLeftMax - element.scrollLeft;\n    availableScroll.deltaYNegative += -element.scrollTop;\n    availableScroll.deltaYPositive += scrollTopMax - element.scrollTop;\n    const parent = element.parentNode;\n    if (parent === null) break;\n    element = parent as Element;\n  }\n\n  return availableScroll;\n}\n\n/**\n * Calculates the scroll distribution for `element` inside` container.\n */\nfunction calculateScrollDistribution(\n  deltaX: number,\n  deltaY: number,\n  element: Element,\n  container: Element,\n  accumulator: ScrollInformation[] = [],\n): ScrollInformation[] {\n  const scrollInformation: ScrollInformation = {\n    element,\n    scrollLeft: 0,\n    scrollTop: 0,\n  };\n  const scrollLeftMax = element.scrollWidth - element.clientWidth;\n  const scrollTopMax = element.scrollHeight - element.clientHeight;\n\n  const availableScroll = {\n    deltaXNegative: -element.scrollLeft,\n    deltaXPositive: scrollLeftMax - element.scrollLeft,\n    deltaYNegative: -element.scrollTop,\n    deltaYPositive: scrollTopMax - element.scrollTop,\n  };\n\n  const elementStyle = window.getComputedStyle(element);\n\n  if (elementStyle.overflowX !== 'hidden') {\n    // The `deltaX` can be larger than the available scroll for the element, thus overshooting.\n    // The result of that is that it scrolls the element as far as possible. We don't need to\n    // calculate exactly because we reduce the amount of desired scroll for the\n    // parent elements by the correct amount below.\n    scrollInformation.scrollLeft = element.scrollLeft + deltaX;\n    if (deltaX > availableScroll.deltaXPositive) {\n      deltaX = deltaX - availableScroll.deltaXPositive;\n    } else if (deltaX < availableScroll.deltaXNegative) {\n      deltaX = deltaX - availableScroll.deltaXNegative;\n    } else {\n      deltaX = 0;\n    }\n  }\n\n  if (elementStyle.overflowY !== 'hidden') {\n    scrollInformation.scrollTop = element.scrollTop + deltaY;\n    if (deltaY > availableScroll.deltaYPositive) {\n      deltaY = deltaY - availableScroll.deltaYPositive;\n    } else if (deltaY < availableScroll.deltaYNegative) {\n      deltaY = deltaY - availableScroll.deltaYNegative;\n    } else {\n      deltaY = 0;\n    }\n  }\n\n  if (element !== container && (deltaX || deltaY)) {\n    return calculateScrollDistribution(\n      deltaX,\n      deltaY,\n      element.parentNode as Element,\n      container,\n      accumulator.concat([scrollInformation]),\n    );\n  }\n\n  return accumulator.concat([scrollInformation]);\n}\n\n// Recursively walks up scroll containers until the delta is distributed or we\n// run out of elements in the allowed-to-scroll container.\nexport function distributeScroll(\n  deltaX: number,\n  deltaY: number,\n  element: Element,\n  container: Element,\n) {\n  const scrollInfos = calculateScrollDistribution(\n    deltaX,\n    deltaY,\n    element,\n    container,\n  );\n  let info;\n\n  for (let i = 0; i < scrollInfos.length; i++) {\n    info = scrollInfos[i];\n    if (info) {\n      info.element.scrollLeft = info.scrollLeft;\n      info.element.scrollTop = info.scrollTop;\n    }\n  }\n}\n"],"names":["DOM_DELTA_PIXEL","DOM_DELTA_LINE","DOM_DELTA_PAGE","LINES_PER_PAGE","scrollLineHeight","undefined","getScrollDeltas","deltaX","deltaY","deltaMode","getScrollLineHeight","iframe","document","createElement","src","style","position","visibility","width","height","border","body","appendChild","iframeDocument","contentWindow","open","write","close","firstElementChild","offsetHeight","removeChild","getAvailableScroll","element","container","availableScroll","deltaXNegative","deltaXPositive","deltaYNegative","deltaYPositive","scrollLeftMax","scrollTopMax","contains","scrollWidth","clientWidth","scrollHeight","clientHeight","scrollLeft","scrollTop","parent","parentNode","calculateScrollDistribution","accumulator","scrollInformation","elementStyle","window","getComputedStyle","overflowX","overflowY","concat","distributeScroll","scrollInfos","info","i","length"],"mappings":"AAUA;AACA;AACA;AACO,MAAMA,eAAe,GAAG;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,cAAc,GAAG;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,cAAc,GAAG;;AAE9B;AACA;AACA;AACA;AACA;AACO,MAAMC,cAAc,GAAG;AAE9B,IAAIC,gBAAoC,GAAGC,SAAS;AAE7C,SAASC,eAAeA,CAAC;AAC9BC,EAAAA,MAAM,GAAG,CAAC;AACVC,EAAAA,MAAM,GAAG,CAAC;AACVC,EAAAA,SAAS,GAAGT;AACd,CAAC,EAAgB;EACf,IAAIS,SAAS,KAAKT,eAAe,EAAE;IACjC,IAAIS,SAAS,KAAKP,cAAc,EAAE;AAChCK,MAAAA,MAAM,IAAIJ,cAAc;AACxBK,MAAAA,MAAM,IAAIL,cAAc;AAC1B,IAAA;AACA,IAAA,MAAMC,gBAAgB,GAAGM,mBAAmB,EAAE;IAC9C,IAAIN,gBAAgB,KAAKC,SAAS,EAAE;AAClCE,MAAAA,MAAM,IAAIH,gBAAgB;AAC1BI,MAAAA,MAAM,IAAIJ,gBAAgB;AAC5B,IAAA;AACF,EAAA;EAEA,OAAO;IAAEG,MAAM;AAAEC,IAAAA;GAAQ;AAC3B;AAEO,SAASE,mBAAmBA,GAAuB;EACxD,IAAIN,gBAAgB,KAAKC,SAAS,EAAE;AAClC,IAAA,MAAMM,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IAC/CF,MAAM,CAACG,GAAG,GAAG,GAAG;AAChBH,IAAAA,MAAM,CAACI,KAAK,CAACC,QAAQ,GAAG,UAAU;AAClCL,IAAAA,MAAM,CAACI,KAAK,CAACE,UAAU,GAAG,QAAQ;AAClCN,IAAAA,MAAM,CAACI,KAAK,CAACG,KAAK,GAAG,KAAK;AAC1BP,IAAAA,MAAM,CAACI,KAAK,CAACI,MAAM,GAAG,KAAK;AAC3BR,IAAAA,MAAM,CAACI,KAAK,CAACK,MAAM,GAAG,MAAM;AAC5BR,IAAAA,QAAQ,CAACS,IAAI,CAACC,WAAW,CAACX,MAAM,CAAC;AACjC,IAAA,MAAMY,cAAc,GAAIZ,MAAM,CAACa,aAAa,CAAYZ,QAAQ;IAChEW,cAAc,CAACE,IAAI,EAAE;AACrBF,IAAAA,cAAc,CAACG,KAAK,CAClB,sEACF,CAAC;IACDH,cAAc,CAACI,KAAK,EAAE;AACtB,IAAA,MAAMN,IAAI,GAAGE,cAAc,CAACF,IAAI;AAChCjB,IAAAA,gBAAgB,GAAIiB,IAAI,CAACO,iBAAiB,CAAiBC,YAAY;AACvEjB,IAAAA,QAAQ,CAACS,IAAI,CAACS,WAAW,CAACnB,MAAM,CAAC;AACnC,EAAA;AACA,EAAA,OAAOP,gBAAgB;AACzB;AAEO,SAAS2B,kBAAkBA,CAACC,OAAgB,EAAEC,SAAkB,EAAE;AACvE,EAAA,MAAMC,eAAe,GAAG;AACtBC,IAAAA,cAAc,EAAE,CAAC;AACjBC,IAAAA,cAAc,EAAE,CAAC;AACjBC,IAAAA,cAAc,EAAE,CAAC;AACjBC,IAAAA,cAAc,EAAE;GACjB;EAED,IAAIC,aAAa,EAAEC,YAAY;EAC/B,OAAOP,SAAS,CAACQ,QAAQ,CAACT,OAAO,CAAC,IAAIC,SAAS,KAAKD,OAAO,EAAE;AAC3DO,IAAAA,aAAa,GAAGP,OAAO,CAACU,WAAW,GAAGV,OAAO,CAACW,WAAW;AACzDH,IAAAA,YAAY,GAAGR,OAAO,CAACY,YAAY,GAAGZ,OAAO,CAACa,YAAY;AAE1DX,IAAAA,eAAe,CAACC,cAAc,IAAI,CAACH,OAAO,CAACc,UAAU;AACrDZ,IAAAA,eAAe,CAACE,cAAc,IAAIG,aAAa,GAAGP,OAAO,CAACc,UAAU;AACpEZ,IAAAA,eAAe,CAACG,cAAc,IAAI,CAACL,OAAO,CAACe,SAAS;AACpDb,IAAAA,eAAe,CAACI,cAAc,IAAIE,YAAY,GAAGR,OAAO,CAACe,SAAS;AAClE,IAAA,MAAMC,MAAM,GAAGhB,OAAO,CAACiB,UAAU;IACjC,IAAID,MAAM,KAAK,IAAI,EAAE;AACrBhB,IAAAA,OAAO,GAAGgB,MAAiB;AAC7B,EAAA;AAEA,EAAA,OAAOd,eAAe;AACxB;;AAEA;AACA;AACA;AACA,SAASgB,2BAA2BA,CAClC3C,MAAc,EACdC,MAAc,EACdwB,OAAgB,EAChBC,SAAkB,EAClBkB,WAAgC,GAAG,EAAE,EAChB;AACrB,EAAA,MAAMC,iBAAoC,GAAG;IAC3CpB,OAAO;AACPc,IAAAA,UAAU,EAAE,CAAC;AACbC,IAAAA,SAAS,EAAE;GACZ;EACD,MAAMR,aAAa,GAAGP,OAAO,CAACU,WAAW,GAAGV,OAAO,CAACW,WAAW;EAC/D,MAAMH,YAAY,GAAGR,OAAO,CAACY,YAAY,GAAGZ,OAAO,CAACa,YAAY;AAEhE,EAAA,MAAMX,eAAe,GAAG;AACtBC,IAAAA,cAAc,EAAE,CAACH,OAAO,CAACc,UAAU;AACnCV,IAAAA,cAAc,EAAEG,aAAa,GAAGP,OAAO,CAACc,UAAU;AAClDT,IAAAA,cAAc,EAAE,CAACL,OAAO,CAACe,SAAS;AAClCT,IAAAA,cAAc,EAAEE,YAAY,GAAGR,OAAO,CAACe;GACxC;AAED,EAAA,MAAMM,YAAY,GAAGC,MAAM,CAACC,gBAAgB,CAACvB,OAAO,CAAC;AAErD,EAAA,IAAIqB,YAAY,CAACG,SAAS,KAAK,QAAQ,EAAE;AACvC;AACA;AACA;AACA;AACAJ,IAAAA,iBAAiB,CAACN,UAAU,GAAGd,OAAO,CAACc,UAAU,GAAGvC,MAAM;AAC1D,IAAA,IAAIA,MAAM,GAAG2B,eAAe,CAACE,cAAc,EAAE;AAC3C7B,MAAAA,MAAM,GAAGA,MAAM,GAAG2B,eAAe,CAACE,cAAc;AAClD,IAAA,CAAC,MAAM,IAAI7B,MAAM,GAAG2B,eAAe,CAACC,cAAc,EAAE;AAClD5B,MAAAA,MAAM,GAAGA,MAAM,GAAG2B,eAAe,CAACC,cAAc;AAClD,IAAA,CAAC,MAAM;AACL5B,MAAAA,MAAM,GAAG,CAAC;AACZ,IAAA;AACF,EAAA;AAEA,EAAA,IAAI8C,YAAY,CAACI,SAAS,KAAK,QAAQ,EAAE;AACvCL,IAAAA,iBAAiB,CAACL,SAAS,GAAGf,OAAO,CAACe,SAAS,GAAGvC,MAAM;AACxD,IAAA,IAAIA,MAAM,GAAG0B,eAAe,CAACI,cAAc,EAAE;AAC3C9B,MAAAA,MAAM,GAAGA,MAAM,GAAG0B,eAAe,CAACI,cAAc;AAClD,IAAA,CAAC,MAAM,IAAI9B,MAAM,GAAG0B,eAAe,CAACG,cAAc,EAAE;AAClD7B,MAAAA,MAAM,GAAGA,MAAM,GAAG0B,eAAe,CAACG,cAAc;AAClD,IAAA,CAAC,MAAM;AACL7B,MAAAA,MAAM,GAAG,CAAC;AACZ,IAAA;AACF,EAAA;EAEA,IAAIwB,OAAO,KAAKC,SAAS,KAAK1B,MAAM,IAAIC,MAAM,CAAC,EAAE;IAC/C,OAAO0C,2BAA2B,CAChC3C,MAAM,EACNC,MAAM,EACNwB,OAAO,CAACiB,UAAU,EAClBhB,SAAS,EACTkB,WAAW,CAACO,MAAM,CAAC,CAACN,iBAAiB,CAAC,CACxC,CAAC;AACH,EAAA;AAEA,EAAA,OAAOD,WAAW,CAACO,MAAM,CAAC,CAACN,iBAAiB,CAAC,CAAC;AAChD;;AAEA;AACA;AACO,SAASO,gBAAgBA,CAC9BpD,MAAc,EACdC,MAAc,EACdwB,OAAgB,EAChBC,SAAkB,EAClB;EACA,MAAM2B,WAAW,GAAGV,2BAA2B,CAC7C3C,MAAM,EACNC,MAAM,EACNwB,OAAO,EACPC,SACF,CAAC;AACD,EAAA,IAAI4B,IAAI;AAER,EAAA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,WAAW,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;AAC3CD,IAAAA,IAAI,GAAGD,WAAW,CAACE,CAAC,CAAC;AACrB,IAAA,IAAID,IAAI,EAAE;AACRA,MAAAA,IAAI,CAAC7B,OAAO,CAACc,UAAU,GAAGe,IAAI,CAACf,UAAU;AACzCe,MAAAA,IAAI,CAAC7B,OAAO,CAACe,SAAS,GAAGc,IAAI,CAACd,SAAS;AACzC,IAAA;AACF,EAAA;AACF;;;;"}